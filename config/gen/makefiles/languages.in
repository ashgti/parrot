# Copyright (C) 2002-2009, Parrot Foundation.
# $Id$

# some commands and locations
@make_set_make@
MAKE          := @make_c@
PERL          := @perl@
RM_F          := @rm_f@
BUILD_DIR     := @build_dir@
RECONFIGURE   := $(PERL) @build_dir@/tools/dev/reconfigure.pl
GIT           := git
HG            := hg
SVN           := svn

# List of languages that are currently managed in the Parrot svn repository
# When adding or removing languages, please update the list
LANGUAGES := \
    abc \
    BASIC befunge bf \
    c99 cardinal chitchat cola \
    dotnet \
    ecmascript \
    forth \
    jako json \
    lisp lolcode \
    ook \
    parrot_compiler pheme PIR pod pynie \
    regex \
    scheme squaak \
    urm

# the default target
all: $(LANGUAGES)

# This is a listing of all targets, that are meant to be called by users
help:
	@echo ""
	@echo "Following targets are available for the user:"
	@echo ""
	@echo "  all:           Make a lot of language implementations."
	@echo "                 This is the default."
	@echo ""
	@echo "  test:          Same as test-unified."
	@echo ""
	@echo "  test-unified:  Unified test suite for a lot of languages."
	@echo ""
	@echo "  test-separate: Run 'make test' in the individual lang dirs."
	@echo ""
	@echo "  clean:         Clean up a lot of languages."
	@echo ""
	@echo "  help:          Print this help message."
	@echo ""
	@echo "Following languages are available in Parrot's svn repository:"
	@echo "  $(LANGUAGES)"
	@echo ""
	@echo "A particular language <lang> can be built, tested and cleand up"
	@echo "  make <lang>"
	@echo "  make <lang>.test"
	@echo "  make <lang>.clean"
	@echo "  make <lang>.realclean"
	@echo ""
	@echo "For the status of individual languages see"
	@echo "https://trac.parrot.org/parrot/wiki/Languages."
	@echo ""
	@echo "Some languages are managed in other repositories."
	@echo "Here are some helpers for checking these languages out."
	@echo "Note that these commands don't guarantee that commits are possible."
	@echo ""
	@echo "  co-all:        Try to fetch externally managed languages"
	@echo ""
	@echo "  co-eclectus:   Try to fetch eclectus"
	@echo ""
	@echo "  co-fun:        Try to fetch fun"
	@echo ""
	@echo "  co-gil:        Try to fetch gil"
	@echo ""
	@echo "  co-hq9plus:    Try to fetch HQ9+"
	@echo ""
	@echo "  co-kea-cl:     Try to fetch kea-cl"
	@echo ""
	@echo "  co-lazy-k:     Try to fetch lazy-k"
	@echo ""
	@echo "  co-lua:        Try to fetch lua"
	@echo ""
	@echo "  co-m4:         Try to fetch Parrot m4"
	@echo ""
	@echo "  co-markdown:   Try to fetch markdown"
	@echo ""
	@echo "  co-matrixy:    Try to fetch matrixy"
	@echo ""
	@echo "  co-paraplegic: Try to fetch Paraplegic"
	@echo ""
	@echo "  co-perk:       Try to fetch Perk"
	@echo ""
	@echo "  co-pipp:       Try to fetch Pipp"
	@echo ""
	@echo "  co-pjs:        Try to fetch PJS"
	@echo ""
	@echo "  co-primitivearc: Try to fetch primitivearc"
	@echo ""
	@echo "  co-punie:      Try to fetch Punie"
	@echo ""
	@echo "  co-rakudo:     Try to fetch Rakudo"
	@echo ""
	@echo "  co-shakespeare: Try to fetch shakespeare"
	@echo ""
	@echo "  co-tcl:        Try to fetch Partcl"
	@echo ""
	@echo "  co-unlambda:   Try to fetch unlambda"
	@echo ""
	@echo "  co-wmlscript:  Try to fetch wmlscript"
	@echo ""
	@echo "NOTE: These make targets assume that you have run the corresponding co target."
	@echo "  up-all:        Try to update externally managed languages"
	@echo ""
	@echo "  up-eclectus:   Try to update eclectus"
	@echo ""
	@echo "  up-fun:        Try to update fun"
	@echo ""
	@echo "  up-gil:        Try to update gil"
	@echo ""
	@echo "  up-hq9plus:    Try to update HQ9+"
	@echo ""
	@echo "  up-kea-cl:     Try to update kea-cl"
	@echo ""
	@echo "  up-lazy-k:     Try to update lazy-k"
	@echo ""
	@echo "  up-lua:        Try to update lua"
	@echo ""
	@echo "  up-m4:         Try to update Parrot m4"
	@echo ""
	@echo "  up-markdown:   Try to update markdown"
	@echo ""
	@echo "  up-matrixy:    Try to update matrixy"
	@echo ""
	@echo "  up-paraplegic: Try to update Paraplegic"
	@echo ""
	@echo "  up-perk:       Try to update Perk"
	@echo ""
	@echo "  up-pipp:       Try to update Pipp"
	@echo ""
	@echo "  up-pjs:        Try to update PJS"
	@echo ""
	@echo "  up-primitivearc: Try to update primitivearc"
	@echo ""
	@echo "  up-punie:      Try to update Punie"
	@echo ""
	@echo "  up-rakudo:     Try to update Rakudo"
	@echo ""
	@echo "  up-shakespeare: Try to update shakespeare"
	@echo ""
	@echo "  up-tcl:        Try to update Partcl"
	@echo ""
	@echo "  up-unlambda:   Try to update unlambda"
	@echo ""
	@echo "  up-wmlscript:  Try to update wmlscript"
	@echo ""

# regenerate the Makefile
Makefile: ../config/gen/makefiles/languages.in
	cd $(BUILD_DIR) && $(RECONFIGURE) --step=gen::languages --languages=""

test:   test-unified

test-unified: all
	$(PERL) t/harness

test-separate: all \
    abc.test \
    befunge.test bf.test \
    c99.test cardinal.test chitchat.test cola.test \
    dotnet.test \
    ecmascript.test \
    forth.test \
    jako.test json.test \
    lisp.test lolcode.test \
    ook.test \
    parrot_compiler.test pheme.test PIR.test pod.test pynie.test \
    regex.test \
    scheme.test squaak.test \
    urm.test

clean: \
    abc.clean \
    BASIC.clean befunge.clean bf.clean \
    c99.clean cardinal.clean chitchat.clean cola.clean \
    dotnet.clean \
    ecmascript.clean \
    forth.clean \
    jako.clean json.clean \
    lisp.clean \
    lolcode.clean \
    ook.clean \
    parrot_compiler.clean pheme.clean PIR.clean pod.clean pynie.clean \
    regex.clean \
    scheme.clean squaak.clean \
    urm.clean

realclean: \
    abc.realclean \
    befunge.realclean bf.realclean \
    c99.realclean cardinal.realclean chitchat.realclean cola.realclean \
    dotnet.realclean \
    ecmascript.realclean \
    forth.realclean \
    jako.realclean json.realclean \
    lisp.realclean lolcode.realclean \
    ook.realclean \
    parrot_compiler.realclean pheme.realclean PIR.realclean pod.realclean pynie.realclean \
    regex.realclean \
    scheme.realclean squaak.realclean \
    urm.realclean


#
# Language specific targets
#

# The *.dummy targets are a replacement for the target .PHONY in 'GNU make'

abc : abc.dummy
abc.dummy:
	- $(MAKE) abc
abc.test:
	- $(MAKE) abc test
abc.clean:
	- $(MAKE) abc clean
abc.realclean:
	- $(MAKE) abc realclean

BASIC : BASIC.dummy
BASIC.dummy:
# don't know how to build BASIC
BASIC.test:
# Don't know how to test BASIC
BASIC.clean:
# Don't know how to clean BASIC

befunge : befunge.dummy
befunge.dummy:
	- $(MAKE) befunge
befunge.test:
	- $(MAKE) befunge test
befunge.clean:
	- $(MAKE) befunge clean
befunge.realclean:
	- $(MAKE) befunge realclean

bf : bf.dummy
bf.dummy:
	- $(MAKE) bf
bf.test:
	- $(MAKE) bf test
bf.clean:
	- $(MAKE) bf clean
bf.realclean:
	- $(MAKE) bf realclean

c99 : c99.dummy
c99.dummy:
	- $(MAKE) c99
c99.test:
	- $(MAKE) c99 test
c99.clean:
	- $(MAKE) c99 clean
c99.realclean:
	- $(MAKE) c99 realclean

cardinal : cardinal.dummy
cardinal.dummy:
	- $(MAKE) cardinal
cardinal.test:
	- $(MAKE) cardinal test
cardinal.clean:
	- $(MAKE) cardinal clean
cardinal.realclean:
	- $(MAKE) cardinal realclean

chitchat : chitchat.dummy
chitchat.dummy:
	- $(MAKE) chitchat
chitchat.test:
	- $(MAKE) chitchat test
chitchat.clean:
	- $(MAKE) chitchat clean
chitchat.realclean:
	- $(MAKE) chitchat realclean

cola : cola.dummy
cola.dummy:
	- $(MAKE) cola
cola.test:
	- $(MAKE) cola test
cola.clean:
	- $(MAKE) cola clean
cola.realclean:
	- $(MAKE) cola realclean

dotnet : dotnet.dummy
dotnet.dummy:
	cd dotnet && $(PERL) Configure.pl
	- $(MAKE) dotnet
dotnet.test:
	- $(MAKE) dotnet test
dotnet.clean:
	- $(MAKE) dotnet clean
dotnet.realclean:
	- $(MAKE) dotnet realclean

ecmascript : ecmascript.dummy
ecmascript.dummy:
	- $(MAKE) ecmascript
ecmascript.test:
	- $(MAKE) ecmascript test
ecmascript.clean:
	- $(MAKE) ecmascript clean
ecmascript.realclean:
	- $(MAKE) ecmascript realclean

forth : forth.dummy
forth.dummy:
	- $(MAKE) forth
forth.test:
	- $(MAKE) forth test
forth.clean:
	- $(MAKE) forth clean
forth.realclean:
	- $(MAKE) forth realclean

jako: jako.dummy
jako.dummy:
	- $(MAKE) jako
jako.test:
	- $(MAKE) jako test
jako.clean:
	- $(MAKE) jako clean
jako.realclean:
	- $(MAKE) jako realclean

json: json.dummy
json.dummy:
	- $(MAKE) json
json.test:
	- $(MAKE) json test
json.clean:
	- $(MAKE) json clean
json.realclean:
	- $(MAKE) json realclean

lisp: lisp.dummy
lisp.dummy:
	- $(MAKE) lisp
lisp.test:
	- $(MAKE) lisp test
lisp.clean:
	- $(MAKE) lisp clean
lisp.realclean:
	- $(MAKE) lisp realclean

lolcode: lolcode.dummy
lolcode.dummy:
	- $(MAKE) lolcode
lolcode.test:
	- $(MAKE) lolcode test
lolcode.clean:
	- $(MAKE) lolcode clean
lolcode.realclean:
	- $(MAKE) lolcode realclean

ook : ook.dummy
ook.dummy:
	- $(MAKE) ook
ook.test:
	- $(MAKE) ook test
ook.clean:
	- $(MAKE) ook clean
ook.realclean:
	- $(MAKE) ook realclean

parrot_compiler: parrot_compiler.dummy
parrot_compiler.dummy:
	- $(MAKE) parrot_compiler
parrot_compiler.test:
	- $(MAKE) parrot_compiler test
parrot_compiler.clean:
	- $(MAKE) parrot_compiler clean
parrot_compiler.realclean:
	- $(MAKE) parrot_compiler realclean

pheme : pheme.dummy
pheme.dummy:
	- $(MAKE) pheme
pheme.test:
	- $(MAKE) pheme test
pheme.clean:
	- $(MAKE) pheme clean
pheme.realclean:
	- $(MAKE) pheme realclean

PIR: PIR.dummy
PIR.dummy:
	- $(MAKE) PIR
PIR.test:
	- $(MAKE) PIR test
PIR.clean:
	- $(MAKE) PIR clean
PIR.realclean:
	- $(MAKE) PIR realclean

pod: pod.dummy
pod.dummy:
	- $(MAKE) pod
pod.test:
	- $(MAKE) pod test
pod.clean:
	- $(MAKE) pod clean
pod.realclean:
	- $(MAKE) pod realclean

pynie : pynie.dummy
pynie.dummy:
	- $(MAKE) pynie
pynie.test:
	- $(MAKE) pynie test
pynie.clean:
	- $(MAKE) pynie clean
pynie.realclean:
	- $(MAKE) pynie realclean

regex: regex.dummy
regex.dummy:
	- $(MAKE) regex
regex.test :
	- $(MAKE) regex test
regex.clean :
	- $(MAKE) regex clean
regex.realclean :
	- $(MAKE) regex realclean

scheme: scheme.dummy
scheme.dummy:
	@echo "SKIPPED: scheme: (nothing to make, but should not default to make test)"
scheme.test :
	- $(MAKE) scheme test
scheme.clean :
	- $(MAKE) scheme clean
scheme.realclean :
	- $(MAKE) scheme realclean

squaak: squaak.dummy
squaak.dummy:
	- $(MAKE) squaak
squaak.test:
	- $(MAKE) squaak test
squaak.clean:
	- $(MAKE) squaak clean
squaak.realclean:
	- $(MAKE) squaak realclean

urm: urm.dummy
urm.dummy:
	- $(MAKE) urm
urm.test:
	- $(MAKE) urm test
urm.clean:
	- $(MAKE) urm clean
urm.realclean:
	- $(MAKE) urm realclean

# helpers for checking out externally managed languages

# check out all known externally managed languages
co-all: \
    co-eclectus \
    co-fun \
    co-gil \
    co-hq9plus \
    co-kea-cl \
    co-lazy-k \
    co-lua \
    co-m4 \
    co-matrixy \
    co-markdown \
    co-paraplegic \
    co-perk \
    co-pipp \
    co-pjs \
    co-primitivearc \
    co-punie \
    co-rakudo \
    co-shakespeare \
    co-tcl \
    co-unlambda \
    co-wmlscript

up-all: \
    up-eclectus \
    up-fun \
    up-gil \
    up-hq9plus \
    up-kea-cl \
    up-lazy-k \
    up-lua \
    up-m4 \
    up-matrixy \
    up-markdown \
    up-paraplegic \
    up-perk \
    up-pipp \
    up-pjs \
    up-primitivearc \
    up-punie \
    up-rakudo \
    up-shakespeare \
    up-tcl \
    up-unlambda \
    up-wmlscript

co-eclectus:
	- $(GIT) clone 'git:////github.com//bschmalhofer//eclectus.git'

up-eclectus:
	cd eclectus &&  $(GIT) pull

co-fun:
	- $(GIT) clone 'git:////github.com//TiMBuS//fun.git'

up-fun:
	cd fun &&  $(GIT) pull

co-gil:
	- $(GIT) clone 'git:////github.com//tene//gil.git'

up-gil:
	cd gil && $(GIT) pull

co-hq9plus:
	- $(GIT) clone 'git:////github.com//bschmalhofer//hq9plus.git'

up-hq9plus:
	cd hq9plus && $(GIT) pull

co-kea-cl:
	- $(SVN) checkout 'https:////rgrjr.dyndns.org//svn//kea-cl//trunk' kea-cl

up-kea-cl:
	cd kea-cl && $(SVN) up

co-lazy-k:
	- $(GIT) clone 'git:////github.com//bschmalhofer//lazy-k.git'

up-lazy-k:
	cd lazy-k && $(GIT) pull

co-lua:
	- $(GIT) clone 'git:////github.com//fperrad//lua.git'

up-lua:
	cd lua && $(GIT) pull

co-m4:
	- $(GIT) clone 'git:////github.com//bschmalhofer//m4.git'

up-m4:
	cd m4 && $(GIT) pull

co-markdown:
	- $(GIT) clone 'git:////github.com//fperrad//markdown.git'

up-markdown:
	cd markdown && $(GIT) pull

co-matrixy:
	- $(SVN) checkout 'http:////matrixy.googlecode.com//svn//trunk' matrixy

up-matrixy:
	cd matrixy && $(SVN) up

co-paraplegic:
	- $(SVN) checkout 'http:////paraplegic.googlecode.com//svn//trunk' paraplegic

up-paraplegic:
	cd paraplegic && $(SVN) up

co-perk:
	- $(GIT) clone 'git:////github.com//chrisdolan//perk.git'

up-perk:
	cd perk && $(GIT) pull

co-pipp:
	- $(GIT) clone 'git:////github.com//bschmalhofer//pipp.git'

up-pipp:
	cd pipp && $(GIT) pull

co-pjs:
	- $(SVN) checkout 'http:////parrotjs.googlecode.com//svn//trunk' pjs

up-pjs:
	cd pjs && $(SVN) up

co-primitivearc:
	- $(GIT) clone 'git:////github.com//stefano//primitivearc.git'

up-primitivearc:
	cd primitivearc && $(GIT) pull

co-punie:
	- $(SVN) checkout 'https:////svn.parrot.org//languages//punie//trunk' punie

up-punie:
	cd punie && $(SVN) up

co-rakudo:
	- $(GIT) clone 'git:////github.com//rakudo//rakudo.git'

up-rakudo:
	cd rakudo && $(GIT) pull

co-shakespeare:
	- $(HG) clone 'http:////bitbucket.org//riffraff//shakespeare-parrot' shakespeare

up-shakespeare:
	cd shakespeare && $(HG) pull

co-tcl:
	- $(SVN) checkout 'http:////partcl.googlecode.com//svn//trunk' tcl

up-tcl:
	cd tcl && $(SVN) up

co-unlambda:
	- $(GIT) clone 'git:////github.com//bschmalhofer//unlambda.git'

up-unlambda:
	cd unlambda && $(GIT) pull

co-wmlscript:
	- $(GIT) clone 'git:////github.com//fperrad//wmlscript.git'

up-wmlscript:
	cd wmlscript && $(GIT) pull

# Local variables:
#   mode: makefile
# End:
# vim: ft=make:

# Copyright: 2005-2006 The Perl Foundation.  All Rights Reserved.
# $Id$

# Setup of some commands
PERL           = @perl@
RM_RF          = @rm_rf@
CP             = @cp@

# The runtime files are also in SVN, need to be generated only by maintainer
PYTHON_RUNTIME_FILES = \
    python/lib/bc/BcLexer.py \
    python/lib/bc/BcParser.py \
    python/lib/bc/BcTreeWalker.py \
    python/lib/antlr_past2pir_past/AntlrPast2PirPastTreeWalker.py

# the default target
all: build 

# This is a listing of all targets, that are meant to be called by users
help:
	@echo ""
	@echo "Following targets are available for the user:"
	@echo ""
	@echo "  all:               BcLexer.py and BcParser.py"
	@echo "                     This is the default."
	@echo ""
	@echo "  maintain:          Generate Python runtime files"
	@echo "                     Needs ANTLR and Python"
	@echo ""
	@echo "Testing:"
	@echo "  test:              Run the test suite."
	@echo ""
	@echo "Cleaning:"
	@echo "  clean:             Basic cleaning up."
	@echo "  distclean:         Remove everything not in MANIFEST."
	@echo ""
	@echo "Misc:"
	@echo "  help:              Print this help message."
	@echo ""

test: build
	cd .. && $(PERL) -I../lib -I bc/lib bc/t/harness --use-gnu-bc

build:
# Nothing to do

maintain: $(PYTHON_RUNTIME_FILES)

# BcLexer.py will be created too
# TODO: antlr_past2pir_past shouldn't need BcLexerTokenTypes.txt
$(PYTHON_RUNTIME_FILES): grammar/antlr_2/bc_python.g grammar/antlr_2/antlr_past2pir_past.g
	antlr -o python/lib/bc grammar/antlr_2/bc_python.g
	$(CP) python/lib/bc/BcLexerTokenTypes.txt python/lib/antlr_past2pir_past
	antlr -o python/lib/antlr_past2pir_past grammar/antlr_2/antlr_past2pir_past.g

clean:
	$(RM_RF) \
    "python/lib/bc/*.pyc" \
    "python/lib/antlr_past2pir_past/*.pyc" \
    "t/*.bc" "t/*.pir" "t/*.posix_out" "t/*.parrot_out"

realclean: clean
	$(RM_RF) \
    Makefile

distclean: realclean

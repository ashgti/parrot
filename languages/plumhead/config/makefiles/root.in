# $Id$

# Setup some commands
PARROT   = ../../parrot@exe@
PERL     = @perl@
RM_F     = @rm_f@

# default
all: build

# This is a listing of all targets, that are meant to be called by users
help:
	@echo ""
	@echo "Following targets are available for the user:"
	@echo ""
	@echo "Building:"
	@echo "  all:               Build plumhead.pbc."
	@echo "                     This is the default."
	@echo ""
	@echo "Testing:"
	@echo "  test:              Run the test suite."
	@echo "  test-php:          Run the test suite for the reference implementation."
	@echo "  test-phc-to-past:  Run the test suite for the Phc2Past variant."
	@echo "  test-antlr3:       Run the test suite for the Antlr3 variant."
	@echo "  test-partridge:    Run the test suite."
	@echo ""
	@echo "Cleaning:"
	@echo "  clean:             makes clean-test."
	@echo "  distclean:         makes clean-test."
	@echo "  clean-test:        Clean up temporary files from testing."
	@echo ""
	@echo "Misc:"
	@echo "  help:              Print this help message."
	@echo ""

plumhead.pbc: src/plumhead.pir
	$(PARROT) -o plumhead.pbc src/plumhead.pir

plumheadlib.pbc: src/builtins.pir
	$(PARROT) -o plumheadlib.pbc src/builtins.pir

test: all test-php test-phc-to-past test-antlr3 test-partridge

test-php:
	- cd .. && $(PERL) -I../lib -I plumhead/lib plumhead/t/harness --with-php

test-phc-to-past:
	- cd .. && $(PERL) -I../lib -I plumhead/lib plumhead/t/harness --with-phc-to-past

test-antlr3:
	- cd .. && $(PERL) -I../lib -I plumhead/lib plumhead/t/harness --with-antlr3

test-partridge:
	- cd .. && $(PERL) -I../lib -I plumhead/lib plumhead/t/harness --with-partridge

build: plumheadlib.pbc plumhead.pbc

clean: clean-test
	$(RM_F) plumheadlib.pbc plumhead.pbc

# Leave the generated test files in place
clean-test:

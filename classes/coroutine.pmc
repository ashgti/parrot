/* Coroutine.pmc
 *  Copyright: 2001-2003 The Perl Foundation.  All Rights Reserved.
 *  CVS Info
 *     $Id$
 *  Overview:
 *     These are the vtable functions for the Coroutine base class
 *  Data Structure and Algorithms:
 *  History:
 *     Initial version by Melvin on 2002/06/6
 *  Notes:
 *  References:
 */

#include "parrot/parrot.h"
#include "parrot/method_util.h"

pmclass Coroutine extends Continuation {

    STRING* name () {
        return whoami;
    }

    void init () {
        PMC_data(SELF) = new_coroutine(INTERP);
        SELF->cache.struct_val = NULL;
        PObj_custom_mark_destroy_SETALL(SELF);
    }


    void* invoke (void* next) {
        struct Parrot_Sub* co = (struct Parrot_Sub*)PMC_data(SELF);
        void * dest = SELF->cache.struct_val;
        SELF->cache.struct_val = next;
	swap_context(interpreter, &co->ctx);

        return dest;
    }

}

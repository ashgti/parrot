O = ${o}
RM_F = ${rm_f}

INC=../include/parrot

H_FILES = $(INC)/parrot.h default.h

O_FILES = default$(O) perlint$(O) perlstring$(O) perlnum$(O) perlundef$(O)

#DO NOT ADD C COMPILER FLAGS HERE
#Add them in Configure.pl--look for the
#comment 'ADD C COMPILER FLAGS HERE'
CFLAGS = ${ccflags} ${cc_debug} -I../include

C_LIBS = ${libs}

CC = ${cc}
PERL = ${perl}

.c$(O):
	$(CC) $(CFLAGS) ${ld_out}$@ -c $<

all : default$(O) perlint$(O) perlnum$(O) perlstring$(O) perlundef$(O)

default.c: default.pmc
	$(PERL) pmc2c.pl default.pmc

default$(O): $(H_FILES)

default.h: default.c
	perl -ne 'next unless /Parrot_default/; s/{/;/;s/^/extern /;print' default.c > default.h

perlint.c: perlint.pmc 
	$(PERL) pmc2c.pl perlint.pmc

perlint$(O): $(H_FILES)

perlnum.c: perlnum.pmc 
	$(PERL) pmc2c.pl perlnum.pmc

perlnum$(O): $(H_FILES)

perlstring.c: perlstring.pmc 
	$(PERL) pmc2c.pl perlstring.pmc

perlstring$(O): $(H_FILES)

perlundef.c: perlundef.pmc 
	$(PERL) pmc2c.pl perlundef.pmc

perlundef$(O): $(H_FILES)

clean:
	$(RM_F) *.c *$(O) default.h

update:
	cvs -q update -dP


#!perl

# You can create the test results using using the command-line md5sum
# like this:
#
# $ echo -n Hello World! | md5sum
# a0f32c7d31302c1427285b1a0fcbb015  -

use strict;
use Parrot::Test tests => 3;

use Parrot::Config;

my $bigendian = $PConfig{bigendian};
my $intsize   = $PConfig{intsize};

SKIP: {

if ($bigendian || $intsize != 4)
{
    skip('MD5 only known to work on small endian 32 bit processors', 3)
}


##############################
# Stress IMCC and parrot using MD5 library

pir_output_is(<<'CODE', <<'OUT', "Miscellaneous words");
.sub _main
    load_bytecode "library/Digest/MD5.imc"
    $P0 = _md5sum ("Hello")
    _md5_print ($P0)
    print "\n"

    $P0 = _md5sum ("Goodbye")
    _md5_print ($P0)
    print "\n"

    $P0 = _md5sum ("Parrot")
    _md5_print ($P0)
    print "\n"

    $P0 = _md5sum ("Hello World!")
    _md5_print ($P0)
    print "\n"

    end
.end
CODE
8b1a9953c4611296a827abf8c47804d7
6fc422233a40a75a1f028e11c3cd1140
e7cb1e977e896954fec46d2ea7832072
ed076287532e86365e841e92bfc50d8c
OUT

pir_output_is(<<'CODE', <<'OUT', "Funny chars");
.sub _main
    load_bytecode "library/Digest/MD5.imc"
    $P0 = _md5sum ("\n\n\n\n\t")
    _md5_print ($P0)
    print "\n"
    end
.end
CODE
b66434493525523b4393ce0d1f2425d7
OUT


my $code = join
    ("\n\n",
     map
     {
	 <<CODE
	     \$P0 = _md5sum ("$_")
	     _md5_print (\$P0)
	     print "\\n"
CODE
;
     }
     (
      "0",
      "01",
      "012",
      "0123",
      "01234",
      "012345",
      "0123456",
      "01234567",
      "012345678",
      "0123456789",
      "01234567890",
      "012345678901",
      "0123456789012",
      "01234567890123",
      "012345678901234",
      "0123456789012345",
      "01234567890123456",
      "012345678901234567",
      "0123456789012345678",
      "01234567890123456789",
      "012345678901234567890",
      "0123456789012345678901",
      "01234567890123456789012",
      "012345678901234567890123",
      "0123456789012345678901234",
      "01234567890123456789012345",
      "012345678901234567890123456",
      "0123456789012345678901234567",
      "01234567890123456789012345678",
      "012345678901234567890123456789",
      "0123456789012345678901234567890",
      "01234567890123456789012345678901",
      "012345678901234567890123456789012",
      "0123456789012345678901234567890123",
      "01234567890123456789012345678901234",
      "012345678901234567890123456789012345",
      "0123456789012345678901234567890123456",
      "01234567890123456789012345678901234567",
      "012345678901234567890123456789012345678",
      "0123456789012345678901234567890123456789",
      "01234567890123456789012345678901234567890",
      "012345678901234567890123456789012345678901",
      "0123456789012345678901234567890123456789012",
      "01234567890123456789012345678901234567890123",
      "012345678901234567890123456789012345678901234",
      "0123456789012345678901234567890123456789012345",
      "01234567890123456789012345678901234567890123456",
      "012345678901234567890123456789012345678901234567",
      "0123456789012345678901234567890123456789012345678",
      "01234567890123456789012345678901234567890123456789",
      "012345678901234567890123456789012345678901234567890",
      "0123456789012345678901234567890123456789012345678901",
      "01234567890123456789012345678901234567890123456789012",
      "012345678901234567890123456789012345678901234567890123",
      "0123456789012345678901234567890123456789012345678901234",
      "01234567890123456789012345678901234567890123456789012345",
      "012345678901234567890123456789012345678901234567890123456",
      "0123456789012345678901234567890123456789012345678901234567",
      "01234567890123456789012345678901234567890123456789012345678",
      "012345678901234567890123456789012345678901234567890123456789",
      "0123456789012345678901234567890123456789012345678901234567890",
      "01234567890123456789012345678901234567890123456789012345678901",
      "012345678901234567890123456789012345678901234567890123456789012",
      "0123456789012345678901234567890123456789012345678901234567890123",
      "01234567890123456789012345678901234567890123456789012345678901234",
      "012345678901234567890123456789012345678901234567890123456789012345",
      "0123456789012345678901234567890123456789012345678901234567890123456",
      "01234567890123456789012345678901234567890123456789012345678901234567",
      "012345678901234567890123456789012345678901234567890123456789012345678",
      "0123456789012345678901234567890123456789012345678901234567890123456789",
      "01234567890123456789012345678901234567890123456789012345678901234567890",
      "012345678901234567890123456789012345678901234567890123456789012345678901",
      "0123456789012345678901234567890123456789012345678901234567890123456789012",
      "01234567890123456789012345678901234567890123456789012345678901234567890123",
      "012345678901234567890123456789012345678901234567890123456789012345678901234",
      "0123456789012345678901234567890123456789012345678901234567890123456789012345",
      "01234567890123456789012345678901234567890123456789012345678901234567890123456",
      "012345678901234567890123456789012345678901234567890123456789012345678901234567",
      "0123456789012345678901234567890123456789012345678901234567890123456789012345678",
      "01234567890123456789012345678901234567890123456789012345678901234567890123456789",
      "012345678901234567890123456789012345678901234567890123456789012345678901234567890",
      "0123456789012345678901234567890123456789012345678901234567890123456789012345678901",
      "01234567890123456789012345678901234567890123456789012345678901234567890123456789012",
      "012345678901234567890123456789012345678901234567890123456789012345678901234567890123",
      "0123456789012345678901234567890123456789012345678901234567890123456789012345678901234",
      "01234567890123456789012345678901234567890123456789012345678901234567890123456789012345",
      "012345678901234567890123456789012345678901234567890123456789012345678901234567890123456",
      "0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567",
      "01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678",
      "012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789",
      "0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890",
      "01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901",
      "012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012",
      "0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123",
      "01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234",
      "012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345",
      "0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456",
      "01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567",
      "012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678",
      "0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789",
      "01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890",
      "012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901",
      "0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012",
      "01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123",
      "012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234",
      "0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345",
      "01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456",
      "012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567",
      "0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678",
      "01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789",
      "012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890",


      )) ;

pir_output_is(<<CODE, <<'OUT', "String lengths");
.sub _main
    load_bytecode "library/Digest/MD5.imc"
    $code
    end
.end
CODE
cfcd208495d565ef66e7dff9f98764da
96a3be3cf272e017046d1b2674a52bd3
d2490f048dc3b77a457e3e450ab4eb38
eb62f6b9306db575c2d596b1279627a4
4100c4d44da9177247e44a5fc1546778
d6a9a933c8aafc51e55ac0662b6e4d4a
124bd1296bec0d9d93c7b52a71ad8d5b
2e9ec317e197819358fbc43afca7d837
22975d8a5ed1b91445f6c55ac121505b
781e5e245d69b566979b86e28d23f2c7
ebe596017db2f8c69136e5d6e594d365
9a09ac0f4c8c2f92d77f2d77612b6f78
28e23e897f070c849a86cd60b9a852c1
ae248bb2a77e470cb92d8e69e5f5affc
78f40ab0050544f9de011de7a4c6ecdb
d927ad81199aa7dcadfdb4e47b6dc694
6def23346f64e0163d9924f2f40c9cf2
d02ebde979264c79e141559fc9f6b65c
b61fd0bcc895bb16c784558934586d97
be497c2168e374f414a351c49379c01a
eaf9acee4b07a9986ce13edadd72ffcc
8b50575826e6ab4102f1335396b29bba
dbdf3116a6627638bff94877f31e56af
607e25deb0f2d06cbbb4d774d60e9aeb
845379ce1cb6ab954f40261250a7d9c8
c548d9f9273d070ada6070611b609e29
d0e16d114b9299f418e781feb7e189ca
7ab3976c761a67b2a1e57bf9eade8576
fecfbf31a749c7403612c47c3633ba6e
4f7223ebadee9fb57b6796570d60638f
274f173711cb1d36f5ce2d4d48ac2350
298bf0197a05149e366b6bb61835a1c1
cf09b5cb769d068e70d248ac7e013ac9
c448e84be268303d169b20280f82bc8b
541a6eada38facbba17bff5ed44512e5
358ab3835dd5371cc890ebadba6c6d6d
3887ce467d1e74ad307acb8896bffeea
f8ea4cba02b3cb898dcb8cef543845b7
8fbaa7868a809afb8a10f910dc6ce372
9f0ae0380ed27dbf6b852843d2eece1f
258b326512843f996b693fe0fc3ab34a
486011c2adb42c5dba82bec5114dc1fc
4870e0d70c0ef3f920286ccbd316a23d
e8d950dec279b91a52d06283592ce27c
604a4d755ea290e04ed2999243bf5b4a
985170ea843a93803a560dc7f445e938
a99cecea30006f01a7ca56b4845cfb7a
a73df556df9e6ceca5d2d3903d639813
fa7499e1c713703d7b28f99cd7f5c654
baed005300234f3d1503c50a48ce8e6f
8c3ef34e616209cb0efe0f6b735c110d
240d6ec1fe28630a9cc9a4978e5524f1
a3360e2d7e28ed4572c3dc16ef705372
3dff83c8fadd26370d5b098409644457
6e7a4fc92eb1c3f6e652425bcc8d44b5
8af270b2847610e742b0791b53648c09
c620bace4cde41bc45a14cfa62ee3487
66f6bb54a54f967caa2607ad2990ecb4
ad76b175d22a98a4e3bc2ad72affc53e
1ced811af47ead374872fcca9d73dd71
057a79e90fca0d805e0938d8e38a638b
10f0b5ba92a04c7502dec778490a9acb
c5e256437e758092dbfe06283e489019
7f7bfd348709deeaace19e3f535f8c54
beb9f48bc802ca5ca043bcc15e219a5a
d6329b22b4b67da8120d0074eb28cb31
061accc64d9dbd228685091cf76d6f58
7ad76683ed7802615406f4efaa1b8d8b
b5c71592955c35707a4ba4edf8dd66de
109eb12c10c45d94ddac8eca7b818bed
8ca2dc1109ec719046f23d92efe819f7
4e4c090b615aa77e69eacc7b77b5cf95
841dba25c1ecaffe412e2e748330a8ae
deb3cb2636d15d6aeccc1951b9d5f183
a6407577c4b42b2e738ad6d56ed1f486
e441c22735877b6c3c9357ba1820d708
778a111027ce535d272143817e6e9d8d
bcb0b673b05701772b02d6b747622c62
471814de0f707d1f04ba37a7d31aba36
0faef1f4cb01d560d59016a2d5e91da6
6e0c4c53a4178accb1c9b98556b8b945
240b6fbc9d3be13b28e949fc5e94a92c
004ef599b79db30564f653354fa2165a
92d36974a72cdde56527eb7e26603075
42b33f3421b374998baab3d0ce9915c7
6cda32041571c398fad2b5979321949b
dcf3495e733de25b7a0465159c48b098
0c6b4c69e1380ecc74124be9a080a2bd
321c5993da3dee64c550e87b81f9af73
3b9739dbce23373276d22e2709e82f6e
db52e041b6faca67496bae11d5177ce9
6e9f209cf47edc69a21b6cc1f7f616f9
95e99b94cdcec3b6f4a2820fb87cd9ed
08eed5e9006f867fb5dedfc42b082df8
7418f52788313c121eef974cd283e8a5
b2b23cfd66f6bdd522c47315752d7731
7c962704271a7a905cbec236de469626
84e15104f912a6cb2768ebdde00e5b33
dde798bd1d5336a07337aec45cb02576
7a08b07e84641703e5f2c836aa59a170
525cce3d8c3eaf36a756a91fcb996d59
6fd9044eb098d000b86615ff9df50e11
364603b2cf1662d139496c12f36f490a
375e3afc44bf428c445bff4363f0dbe5
477ac3a1c002d85755b40451c8db87d2
3c6f3dfa17a3022cf18db24e42f54b96
d2cfbebc441bea6a9c9c4a2faba865e2
01fb84949f9192411682b39e2642b662
2468a5c59cccb56bd51ed5ee766b2d2b
09e32555adc12a6f2c8fed9a459935af
6c27622d1d5365e4abfd02f2eccfd8f9
OUT
}
